<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[runtimeä¹‹NSArrayå®‰å…¨]]></title>
      <url>http://yoursite.com/2016/01/22/runtime%E4%B9%8BNSArray%E3%80%81NSDictionary%E5%AE%89%E5%85%A8/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>çœ‹äº†<a href="http://www.cnblogs.com/muyushifang07/p/5737564.html" target="_blank" rel="external"><strong>æ²é›¨åæ–¹07</strong></a>çš„è¿™ç¯‡åšå®¢ä¹‹åï¼Œæˆ‘å†³å®šå°†è‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„ä¸€ä¸ªå°æŠ€å·§åˆ†äº«ä¸€ä¸‹,ä»¥æ–¹ä¾¿å„ç§çŒ¿çš„ç¨‹åºå¼€å‘ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨appleçš„æ·«å¨ä¸‹NSArray,NSDictionary,NSMutableArray,NSMutableDictionaryæ˜¯ä¸ä¸èƒ½å‡ºç°æœ‰å…³nilçš„æ“ä½œ,ä¸€æ—¦æ“ä½œå°±ä¼šå‡ºç°<strong>crash</strong>çš„åæœ,å¦‚æœæˆ‘ä»¬è¦é¿å…è¿™ç§<strong>crash</strong>é‚£ä¹ˆå°±è¦å¢åŠ è®¸å¤šif,ç°åœ¨æˆ‘ä»¬æ¥åˆ©ç”¨runtimeå½»åº•è§£å†³è¿™ä¸ªé—®é¢˜.<br><br><br><a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demoåœ°å€ : https://github.com/OneHalfTooth/Runtime_Safe</a></p>
<p><strong>é¦–å…ˆæˆ‘ä»¬å¯èƒ½ç”¨åˆ°å‡ ä¸ªå‡½æ•°</strong>ï¼ˆéœ€è¦åŒ…å«<font color="red">è¿è¡Œæ—¶åº“</font>ï¼‰<br><br> <font color="red">class_getInstanceMethod(Class cls, SEL name):å¾—åˆ°ç±»çš„å®ä¾‹æ–¹æ³•</font></p>
  <font color="red">class_getClassMethod(Class cls, SEL name):å¾—åˆ°ç±»çš„ç±»æ–¹æ³•</font>

<p>  <font color="red"> method_exchangeImplementations(Method m1, Method m2) : äº¤æ¢æ–¹æ³•m1 å’Œæ–¹æ³•m2çš„å®ç°</font></p>
<h2 id="runtimeä¹‹NSArrayçš„nilæ“ä½œ"><a href="#runtimeä¹‹NSArrayçš„nilæ“ä½œ" class="headerlink" title="runtimeä¹‹NSArrayçš„nilæ“ä½œ"></a>runtimeä¹‹NSArrayçš„nilæ“ä½œ</h2><p>ç ä»£ç çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸€ä¸å°å¿ƒå¯èƒ½å°±ä¼šå‡ºç°ç±»ä¼¼äºè¿™ç§æƒ…å†µ</p>
<pre><code>NSArray * temp = @[@&quot;0&quot;,@&quot;1&quot;,@&quot;2&quot;];
NSString * str = [temp objectAtIndex:4];
</code></pre><p>åæœå°±æ˜¯<strong>crash</strong><br><br>ä½†æ˜¯æˆ‘ä»¬å‘ç°å¤§ç‰›ä»¬å†™ä»£ç çš„æ—¶å€™é€šå¸¸<strong>å¾ˆå°‘å‡ºç°å¯¹æ•°ç»„è¶Šç•Œ</strong>çš„å¼‚å¸¸å¤„ç†æƒ…å†µ,åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ğŸ˜<br><br>è€Œæˆ‘æ˜¯ä½¿ç”¨runtimeçš„é»‘é­”æ³•æ¥è§£å†³è¿™ç§æƒ…å†µçš„,è¯·çœ‹æºç <br></p>
<pre><code>- (id)custmeObjectAtIndex:(NSInteger)index{
if (index &gt;= self.count) {
    return nil;
}
//æˆ–è®¸ä½ å¯¹è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œç¨åè§£ç­”
return [self custmeObjectAtIndex:index];
}
</code></pre><p>é¦–å…ˆæˆ‘å£°æ˜ä¸€ä¸ªæ–¹æ³•,å› ä¸ºæˆ‘è¦ç”¨é»‘é­”æ³•<font color="red">ï¼ˆMethod Swizzlingï¼‰</font>å°†ç³»ç»Ÿçš„<strong>objectAtIndex:</strong>æ–¹æ³•å®ç°ç»™æ›¿æ¢æ‰,è¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨<strong>NSArrayè°ƒç”¨objectAtIndex:</strong>æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆè°ƒç”¨<strong>(custmeObjectAtIndex:)</strong>æœ¬äººå®šä¹‰å¥½çš„æ–¹æ³•,ç„¶ååœ¨custmeObjectAtIndex:è¿™ä¸ªæ–¹æ³•ä¸­å»åˆ¤æ–­å‚æ•°åˆæ³•æ€§ï¼Œå†åšä¸‹ä¸€æ­¥æ‰“ç®—.<br><br>ç„¶åæˆ‘ä»¬å¼€å§‹ä½¿ç”¨<font color="red">ï¼ˆMethod Swizzlingï¼‰</font>å°†ç³»ç»Ÿ<strong>objectAtIndex:</strong>çš„å®ç°å’Œ<strong>(custmeObjectAtIndex:)</strong>çš„å®ç°è¿›è¡Œäº¤æ¢</p>
<pre><code>//NSArray åœ¨ç¼–è¯‘çš„æ—¶å€™åå­—å¹¶ä¸æ˜¯NSarrayè€Œæ˜¯__NSArray0
Class arrayM = NSClassFromString(@&quot;__NSArray0&quot;);

//è·å–åˆ°ç³»ç»ŸobjectAtIndex:
Method objectAtIndex = class_getInstanceMethod(arrayM, @selector(objectAtIndex:));

//è·å–è‡ªå®šä¹‰çš„custmeObjectAtIndex:
Method customeObjectAtIndex = class_getInstanceMethod(arrayM, @selector(custmeObjectAtIndex:));

//äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°
method_exchangeImplementations(objectAtIndex, customeObjectAtIndex);
</code></pre><p>è‡³æ­¤,æˆ‘ä»¬å¸¸è§çš„æ•°ç»„è¶Šç•Œcrashå·²ç»è¢«è§£å†³äº†,ä½†æ˜¯ä½ æ˜¯ä¸æ˜¯å·²ç»è’™åœˆäº†ğŸ˜,ä¸ºä»€ä¹ˆåœ¨<strong>- (id)custmeObjectAtIndex:(NSInteger)index</strong>æ–¹æ³•ä¸­å‡ºç°äº† <strong>[self custmeObjectAtIndex:index];</strong>è‡ªå·±è°ƒç”¨è‡ªå·±è¿™ç§æƒ…å†µå‘¢,å‰è¾¹æˆ‘å·²ç»è¯´äº†æ˜¯äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°,æ‰€ä»¥è¯´ä¸¤ä¸ªæ–¹æ³•çš„å†…å®¹<strong>(ç®€å•çš„è¯´å°±æ˜¯æ–¹æ³•é‡Œè¾¹çš„ä»£ç )</strong>å·²ç»è¢«äº¤æ¢,æ‰€ä»¥[self custmeObjectAtIndex:index]è¿™å¥ä»£ç è°ƒç”¨çš„ç³»ç»ŸobjectAtIndex:çš„å®ç°ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±</p>
<p><strong>è‡³æ­¤ä¸€ä¸ªå…³äºNSArrayçš„runtimeå·²ç»ç»“æŸ,æ›´å¤šè¯·<a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">æŸ¥çœ‹demo</a></strong><br><br><strong>æ¬¢è¿æå‡ºæ‚¨çš„å®è´µæ„è§:<font color="blue">mayang_email@sina.cn</font></strong></p>
]]></content>
    </entry>
    
  
  
</search>
