<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[runtimeä¹‹NSMutableDictionaryå®‰å…¨]]></title>
      <url>http://yoursite.com/2016/01/24/runtime%E4%B9%8BNSMutableDictionary%E5%AE%89%E5%85%A8/</url>
      <content type="html"><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥,appleè¦æ±‚æˆ‘ä»¬åœ¨NSMutableDictionaryä¸­ä¸èƒ½æ’å…¥nil,æ‰€ä»¥æˆ‘ä»¬ä¸€æ—¦å‡ºç°è¿™ç§æ“ä½œå°±ä¼šcrash,ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ä¿è¯å®Œå…¨ä¸ä¼šå‡ºç°è¿™ç§æ“ä½œ,é™¤éä½¿ç”¨å¤§é‡ifå»åšå‚æ•°åˆæ³•æ€§åˆ¤æ–­</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSMutableDictionary * testDic = [[NSMutableDictionary alloc]init];</div><div class="line">[testDic setObject:nil forKey:@&quot;key&quot;];</div><div class="line">[testDic removeObjectForKey:nil];</div></pre></td></tr></table></figure>
<p><strong>æ¯”å¦‚ä»¥ä¸Šä¸¤ç§æƒ…å†µ,è‚¯å®šæ¯«ä¸çŠ¹è±«çš„å°±crash</strong><br><br><strong>æ³¨æ„:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">testDic[&quot;key&quot;] = nil;</div></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸ä¼šå´©æºƒçš„,å› ä¸ºç³»ç»Ÿé»˜è®¤åšäº†ç©ºå€¼æ£€æŸ¥,æ¨èä»¥åéƒ½ç”¨è¿™ç§å†™æ³•.</p>
<h5 id="æˆ‘ä»¬ç°åœ¨è¦åšçš„å¦‚æœå°±æ˜¯ä½ ä¸€ä¸å°å¿ƒå‡ºç°ä»¥ä¸Šæ“ä½œ-ç¨‹åºä¸ä¼šcrash"><a href="#æˆ‘ä»¬ç°åœ¨è¦åšçš„å¦‚æœå°±æ˜¯ä½ ä¸€ä¸å°å¿ƒå‡ºç°ä»¥ä¸Šæ“ä½œ-ç¨‹åºä¸ä¼šcrash" class="headerlink" title="æˆ‘ä»¬ç°åœ¨è¦åšçš„å¦‚æœå°±æ˜¯ä½ ä¸€ä¸å°å¿ƒå‡ºç°ä»¥ä¸Šæ“ä½œ,ç¨‹åºä¸ä¼šcrash"></a>æˆ‘ä»¬ç°åœ¨è¦åšçš„å¦‚æœå°±æ˜¯ä½ ä¸€ä¸å°å¿ƒå‡ºç°ä»¥ä¸Šæ“ä½œ,ç¨‹åºä¸ä¼šcrash</h5><p><strong>æˆ‘ä»¬è¦ç”¨åˆ°è¿™ä¹ˆå‡ ä¸ªæ–¹æ³•</strong></p>
<font color="green"><br>//å¾—åˆ°ç±»çš„å®ä¾‹æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>1ã€</strong> class_getInstanceMethod(Class cls, SEL name)<br><br><font color="green"> //å¾—åˆ°ç±»çš„ç±»æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>2ã€</strong> class_getClassMethod(Class cls, SEL name)<br><br><font color="green"> //äº¤æ¢æ–¹æ³•m1 å’Œæ–¹æ³•m2çš„å®ç°</font><br><strong>3ã€</strong> method_exchangeImplementations(Method m1, Method m2)<br><br><font color="green"> /*å°±åƒApplicationæœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ä¸€æ ·,åœ¨Objective-Cçš„ç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™çš„å›è°ƒæ–¹æ³•,å¯ä»¥ä½¿ç”¨ Method Swizzing ä»¥ä¿è¯ Method SwizzingæˆåŠŸ*/</font><br><strong>4ã€</strong> + (void)load<br>

<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ol>
<li>ä½¿ç”¨runtime <font color="red"> Method Swizzing </font>æ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•</li>
<li>è®©ç¨‹åºæ¯æ¬¡è°ƒç”¨çš„ä»¥ä¸Šå‡ ä¸ªæ–¹æ³•ä¹‹å‰,é¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•</li>
<li>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­æ ¡éªŒå‚æ•°åˆæ³•æ€§ç­‰,ä»¥ä¿éšœä¹‹åè°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•ä¸ä¼šäº§ç”Ÿ<font color="red">crash</font></li>
<li>æ‰§è¡Œå®Œå‚æ•°åˆæ³•æ€§åˆ¤æ–­ä¹‹å,è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•,ä»¥è¾¾åˆ°é¢„æœŸè°ƒç”¨ç›®çš„</li>
</ol>
<h3 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹ "></a><font color="red">è¦ç‚¹ </font></h3><ol>
<li>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­NSMutableArrayå¯¹è±¡çš„Class åº”è¯¥æ˜¯<font color="red"><strong>__NSDictionaryM</strong> </font><small>(æ³¨æ„æ˜¯åŒä¸‹åˆ’çº¿)</small></li>
<li>å¿…é¡»ä¿è¯åœ¨NSMutableArrayè¿™ä¸ªå¯¹è±¡åˆå§‹åŒ–,æˆ–è€…ä½¿ç”¨ä¹‹å‰å·²ç»å®Œæˆ<font color="red"> <strong>Method Swizzing</strong> </font>æ›¿æ¢</li>
</ol>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p> <strong>é¦–å…ˆæˆ‘ä»¬æ¥å®Œæˆå‰ä¸‰æ­¥</strong></p>
<pre><code> -(void)customSetObject:(id)anObject forKey:(id&lt;NSCopying&gt;)aKey{
    if (anObject) {
       [self customSetObject:anObject forKey:aKey];
    }else{
       NSLog(@&quot;setObjectäº†ä¸€ä¸ªç©ºï¼Œkeyä¸º%@&quot;,aKey);
   }
}
-(void)customRemoveObjectForKey:(id)aKey{
    if (aKey) {
        [self customRemoveObjectForKey:aKey];
    }else{
       NSLog(@&quot;removeäº†ä¸€ä¸ªç©ºï¼Œkeyä¸º%@&quot;,aKey);
    }
}
</code></pre><p><strong>è‡³æ­¤ ç”¨æ¥æ›¿æ¢ç³»ç»Ÿæ–¹æ³•çš„æ–¹æ³•å·²ç»å‡†å¤‡å¥½äº†</strong><br><br><strong>ç„¶åæˆ‘ä»¬è¦ç”¨è‡ªå·±çš„æ–¹æ³•å»æ›¿æ¢ç³»ç»Ÿçš„æ–¹æ³•çš„å®ç°</strong></p>
<pre><code>+(void)load{
    Class dictCls = NSClassFromString(@&quot;__NSDictionaryM&quot;);

    Method methodSetObjSuper = class_getInstanceMethod(dictCls, NSSelectorFromString(@&quot;setObject:forKey:&quot;));
    Method methodSetObj = class_getInstanceMethod(dictCls, @selector(customSetObject:forKey:));
    method_exchangeImplementations(methodSetObj, methodSetObjSuper);

    Method methodSuperRemoveKey = class_getInstanceMethod(dictCls, @selector(removeObjectForKey:));
    Method methodRemoveKey = class_getInstanceMethod(dictCls, @selector(customRemoveObjectForKey:));
    method_exchangeImplementations(methodRemoveKey, methodSuperRemoveKey);
}
</code></pre><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong> NSMutableDictionaryåœ¨ç¼–è¯‘çš„æ—¶å€™æ˜¯__NSDictionaryMç±»(åŒä¸‹åˆ’çº¿)</p>
<h3 id="ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªNSMutableDictionaryçš„åˆ†ç±»å°†ä»£ç æ”¾è¿›å»"><a href="#ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªNSMutableDictionaryçš„åˆ†ç±»å°†ä»£ç æ”¾è¿›å»" class="headerlink" title="ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªNSMutableDictionaryçš„åˆ†ç±»å°†ä»£ç æ”¾è¿›å»"></a>ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªNSMutableDictionaryçš„åˆ†ç±»å°†ä»£ç æ”¾è¿›å»</h3><p><strong>æ¯”å¦‚</strong><br><img src="/img/NSMutableDictionary.png"><br>ç„¶åä½ å°±å¯ä»¥å°è¯•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSMutableDictionary * testDic = [[NSMutableDictionary alloc]init];</div><div class="line">[testDic setObject:nil forKey:@&quot;key&quot;];</div><div class="line">[testDic removeObjectForKey:nil];</div></pre></td></tr></table></figure></p>
<p>ç„¶åä½ å°±ä¼šå‘ç°ç¨‹åºå¹¶æ²¡æœ‰å´©æºƒ,å…¶å®åŸç†éå¸¸ç®€å•.</p>
<ol>
<li>æˆ‘ä»¬åœ¨ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™å·²ç»å°†ç³»ç»Ÿçš„æ–¹æ³•å®ç°æ›¿æ¢æˆè‡ªå·±çš„,åŒæ—¶ä¹Ÿå°†è‡ªå·±çš„æ–¹æ³•å®ç°æ›¿æ¢æˆç³»ç»Ÿçš„,æ‰€ä»¥å¦‚æœæƒ³æ‰§è¡Œç³»ç»Ÿçš„æ–¹æ³•,å…¶å®ä¼šå…ˆæ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•å®ç°,æˆ‘ä»¬åœ¨è‡ªå·±çš„æ–¹æ³•å®ç°ä¸­åšå‚æ•°åˆæ³•æ€§åˆ¤æ–­,å¦‚æœä¸ä¼šå¼•èµ·ç³»ç»Ÿå´©æºƒé‚£æˆ‘ä»¬å°±å»è°ƒç”¨ç³»ç»Ÿæ–¹æ³•,ä¼šå¼•èµ·çš„è¯å°±ä¸è°ƒç”¨,æ‰€ä»¥è‚¯å®šä¸ä¼šå´©æºƒ.</li>
</ol>
<h2 id="demo-https-github-com-OneHalfTooth-Runtime-Safe"><a href="#demo-https-github-com-OneHalfTooth-Runtime-Safe" class="headerlink" title="demo(https://github.com/OneHalfTooth/Runtime_Safe"></a><a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demo(https://github.com/OneHalfTooth/Runtime_Safe</a></h2><p><strong>ä¸ªäººé‚®ç®±:mayang_email@sina.cn</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[runtimeä¹‹NSDictionaryå®‰å…¨]]></title>
      <url>http://yoursite.com/2016/01/24/runtime%E4%B9%8BNSDictionary%E5%AE%89%E5%85%A8/</url>
      <content type="html"><![CDATA[<p>æ˜¨å¤©å·²ç»å†™æ–‡ç« æ¢è®¨<a href="http://www.masyang.com/2016/01/23/runtimeä¹‹NSMutableArrayå®‰å…¨/" target="_blank" rel="external">runtimeä¹‹NSDictionaryå®‰å…¨</a>é‚£ä¹ˆä»Šå¤©æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹æ€æ ·è®©NSDictionaryå®‰å…¨,ä½¿NSDictionaryæ“ä½œnilè€Œä¸crash<br><a id="more"></a></p>
<h2 id="è¦è§£å†³çš„é—®é¢˜"><a href="#è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="è¦è§£å†³çš„é—®é¢˜"></a>è¦è§£å†³çš„é—®é¢˜</h2><p> åœ¨NSDictionaryä¸­ä¸ç®¡æ˜¯keyè¿˜æ˜¯valueæ˜¯ä¸èƒ½å‡ºç°nilçš„,ç„¶è€Œæˆ‘ä»¬åœ¨åšä»»ä½•æœ‰å…³NSDictionaryæ“ä½œçš„æ—¶å€™æˆ‘ä»¬éƒ½è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜,å‚æ•°ä¼šä¸ä¼šæ˜¯nil,ä¼šä¸ä¼šå¼•èµ·å´©æºƒ.ç„¶åæˆ‘ä»¬ä¸ºäº†ç¨‹åºçš„å¥å£®æ€§,å°±å†™äº†ä¸€å †if,æ¥æ ¡éªŒå‚æ•°åˆæ³•æ€§.æ¥ä¿è¯ç¨‹åºä¸ä¼šå†è¿è¡Œçš„æ—¶å€™crash.<br> ç°åœ¨æˆ‘ä»¬ç”¨runtime,ä»æ ¹æœ¬ä¸Šå»é¢„é˜²NSDictionaryæ’å…¥nilå´©æºƒè¿™ç§é—®é¢˜<br><br> <strong>ç›¸å¯¹äºNSMutableDictionaryæ¥è¯´NSDictionaryæˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜å°±è¦å°‘çš„å¤š</strong><br><br>æ¯”å¦‚<font color="red"><strong>NSDictionary * test = @{@â€crashâ€: nil, @â€keyâ€: @â€valueâ€};</strong></font><br><br><strong>åœ¨è¿™åªæ¼”ç¤ºæ›¿æ¢ä¸€ä¸ªæ–¹æ³•,å¦‚æœ‰æ›´å¤šéœ€è¦è¯·çœ‹<a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demo:https://github.com/OneHalfTooth/Runtime_Safe</a></strong></p>
<h2 id="è¦ä½¿ç”¨çš„æ–¹æ³•"><a href="#è¦ä½¿ç”¨çš„æ–¹æ³•" class="headerlink" title="è¦ä½¿ç”¨çš„æ–¹æ³•"></a>è¦ä½¿ç”¨çš„æ–¹æ³•</h2><font color="green"><br>//å¾—åˆ°ç±»çš„å®ä¾‹æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>1ã€</strong> class_getInstanceMethod(Class cls, SEL name)<br><br><font color="green"> //å¾—åˆ°ç±»çš„ç±»æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>2ã€</strong> class_getClassMethod(Class cls, SEL name)<br><br><font color="green"> //äº¤æ¢æ–¹æ³•m1 å’Œæ–¹æ³•m2çš„å®ç°</font><br><strong>3ã€</strong> method_exchangeImplementations(Method m1, Method m2)<br><br><font color="green"> /*å°±åƒApplicationæœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ä¸€æ ·,åœ¨Objective-Cçš„ç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™çš„å›è°ƒæ–¹æ³•,å¯ä»¥ä½¿ç”¨ Method Swizzing ä»¥ä¿è¯ Method SwizzingæˆåŠŸ*/</font><br><strong>4ã€</strong> + (void)load<br>

<h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><h5 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h5><ol>
<li>ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹æ³•,å°†ç³»ç»Ÿçš„æ–¹æ³•æ›¿æ¢æ‰</li>
<li>åœ¨è‡ªå®šä¹‰æ–¹æ³•ä¸­åšå‚æ•°åˆæ³•æ€§åˆ¤æ–­</li>
<li>è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•ä»¥è¾¾åˆ°é¢„æœŸç›®çš„</li>
<li>äº¤æ¢è‡ªå®šä¹‰æ–¹æ³•ä¸ç³»ç»Ÿæ–¹æ³•çš„å®ç°</li>
</ol>
<h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><ol>
<li>å®ç°è§£å†³æ€è·¯çš„å‰ä¸‰æ­¥<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">+(instancetype)customDictionaryWithObjects:(const id [])objects forKeys:(const id &lt;NSCopying&gt; [])keys count:(NSUInteger)cnt &#123;</div><div class="line">	id nObjects[cnt];</div><div class="line">	id nKeys[cnt];</div><div class="line">	int i=0, j=0;</div><div class="line">	for (; i&lt;cnt &amp;&amp; j&lt;cnt; i++) &#123;</div><div class="line">		if (objects[i] &amp;&amp; keys[i]) &#123;</div><div class="line">			nObjects[j] = objects[i];</div><div class="line">			nKeys[j] = keys[i];</div><div class="line">			j++;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return [self customDictionaryWithObjects:nObjects forKeys:nKeys count:j];//è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>å¯¹objectsè¿›è¡Œç©ºå€¼è¿‡æ»¤ï¼Œå¦‚æœæ˜¯ç©ºå€¼çš„è¯ï¼Œä¸æ’å…¥å­—å…¸ã€‚è¾¾åˆ°å‚æ•°åˆæ³•æ€§åˆ¤æ–­çš„ç›®çš„</strong></p>
<ol>
<li>æ›¿æ¢ç³»ç»Ÿçš„æ–¹æ³•</li>
</ol>
<pre><code>+(void)load{
    Method originalMethod = class_getClassMethod(self, @selector(dictionaryWithObjects:forKeys:count:));
    Method swizzledMethod = class_getClassMethod(self, @selector(customDictionaryWithObjects:forKeys:count:));
    method_exchangeImplementations(originalMethod, swizzledMethod);
}
</code></pre><h2 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h2><ol>
<li><p><strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨loadä¸­æ‰§è¡ŒMethod Swizzing</strong><br><br> å› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç±»åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¿è¯ç³»ç»Ÿæ–¹æ³•çš„å®ç°å·²ç»è¢«æˆ‘ä»¬æ›¿æ¢</p>
</li>
<li><p><strong>ä»¥ä¸Šä»£ç ä¸­å‡ºç°è‡ªå·±è°ƒç”¨è‡ªå·±çš„æ­»å¾ªç¯</strong><br> å¦‚æœä½ ç»†å¿ƒè‚¯å®šä¼šå‘ç°ä¸Šè¾¹è‡ªå®šä¹‰æ–¹æ³•é‡Œè¾¹å‡ºç°äº†è‡ªå·±è°ƒç”¨è‡ªå·±çš„æƒ…å†µ,ä½†æ˜¯æˆ‘åœ¨åè¾¹çš„æ³¨é‡Šç¡®æ˜¯//è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•. æ­£å¸¸çš„è¯´,è¿™ç§æƒ…å†µåº”è¯¥æ˜¯ä¸€ä¸ªæ­»å¾ªç¯,ä½†æ˜¯ä½ ä¸è¦å¿˜äº†ç°åœ¨æˆ‘ä»¬ä½¿ç”¨äº†Method Swizzing,æˆ‘ä»¬å·²ç»ç”¨runtime å°†è‡ªå®šä¹‰æ–¹æ³•çš„æ–¹æ³•çš„å®ç°ä¸ç³»ç»Ÿçš„å®ç°äº¤æ¢ æˆ‘ä»¬äº¤æ¢çš„åªæ˜¯å®ç°,åªæ˜¯æ–¹æ³•åè¿˜æ˜¯æ²¡æœ‰å˜</p>
</li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[runtimeä¹‹NSMutableArrayå®‰å…¨]]></title>
      <url>http://yoursite.com/2016/01/23/runtime%E4%B9%8BNSMutableArray%E5%AE%89%E5%85%A8/</url>
      <content type="html"><![CDATA[<p>æ˜¨å¤©çš„<strong><a href="http://www.masyang.com/2016/01/22/runtimeä¹‹NSArrayã€NSDictionaryå®‰å…¨/" target="_blank" rel="external">åšæ–‡:runtimeä¹‹NSArrayå®‰å…¨</a></strong>å·²ç»ä»‹ç»äº†æœ‰å…³é€šè¿‡<font color="red"> Swizzing </font>ä½¿NSArrayå®‰å…¨çš„æ“ä½œ,é‚£ä¹ˆä»Šå¤©æˆ‘ä»¬æ¥è°ˆä¸€ä¸‹ç›¸å¯¹ç¹ççš„ä½¿ç”¨Swizzingè®©NSMutableArrayå®‰å…¨çš„æ“ä½œ.<small>PS:æ–‡ç¬”ä¸è¡Œ,æœ›æµ·æ¶µ</small></p>
   <a id="more"></a>  
<p><strong><a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demoåœ°å€ : https://github.com/OneHalfTooth/Runtime_Safe</a></strong></p>
<h2 id="ç”¨åˆ°çš„æ–¹æ³•"><a href="#ç”¨åˆ°çš„æ–¹æ³•" class="headerlink" title="ç”¨åˆ°çš„æ–¹æ³•"></a>ç”¨åˆ°çš„æ–¹æ³•</h2><font color="green"><br>//å¾—åˆ°ç±»çš„å®ä¾‹æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>1ã€</strong> class_getInstanceMethod(Class cls, SEL name)<br><br><font color="green"> //å¾—åˆ°ç±»çš„ç±»æ–¹æ³•çš„å®ç° è¿”å›å€¼ä¸ºMethodç±»å‹</font><br><strong>2ã€</strong> class_getClassMethod(Class cls, SEL name)<br><br><font color="green"> //äº¤æ¢æ–¹æ³•m1 å’Œæ–¹æ³•m2çš„å®ç°</font><br><strong>3ã€</strong> method_exchangeImplementations(Method m1, Method m2)<br><br><font color="green"> /*å°±åƒApplicationæœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ä¸€æ ·,åœ¨Objective-Cçš„ç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™çš„å›è°ƒæ–¹æ³•,å¯ä»¥ä½¿ç”¨ Method Swizzing ä»¥ä¿è¯ Method SwizzingæˆåŠŸ*/</font><br><strong>4ã€</strong> + (void)load<br>

<h2 id="è¦è§£å†³çš„ç—›ç‚¹"><a href="#è¦è§£å†³çš„ç—›ç‚¹" class="headerlink" title="è¦è§£å†³çš„ç—›ç‚¹"></a>è¦è§£å†³çš„ç—›ç‚¹</h2><p><strong>NSMutableArray * array = [[NSMutableArray alloc]init];</strong></p>
<p><font color="green">/* arrayè¿½åŠ ä¸€ä¸ªnilå¯¹è±¡*/</font><br><strong>1.</strong> [array addObject:nil];</p>
<p><font color="green">/* arrayè¿½åŠ ä¸€ä¸ªnilçš„æ•°ç»„*/</font><br><strong>2.</strong> [array addObjectsFromArray:nil];</p>
<p><font color="green">/* arrayæ’å…¥ä¸€ä¸ªnil*/</font><br><strong>3.</strong> [array insertObject:nil atIndex:0];</p>
<p><font color="green">/* åœ¨arrayå¤§äºarray.count ä½ç½®æ’å…¥ä¸€ä¸ªå¯¹è±¡*/</font><br><strong>4.</strong> [array insertObject:@â€keyâ€ atIndex:9999];</p>
<p><font color="green">/* arrayç§»é™¤ä¸€ä¸ªnilçš„å¯¹è±¡*/</font><br><strong>5.</strong> [array removeObject:nil];</p>
<p><font color="green">/* ç§»é™¤arrayå¤§äºarray.count ä½ç½®çš„å¯¹è±¡*/</font><br><strong>6.</strong> [array removeObjectAtIndex:9999];</p>
<p><strong>ä»¥ä¸Šæƒ…å†µåŸºæœ¬éƒ½èƒ½å¯¼è‡´åº”ç”¨crash,ç°åœ¨æˆ‘ä»¬å°±æ¥å½»åº•è§£å†³è¿™ç§crash</strong></p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h5><ol>
<li>ä½¿ç”¨runtime <font color="red"> Method Swizzing </font>æ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•</li>
<li>è®©ç¨‹åºæ¯æ¬¡è°ƒç”¨çš„ä»¥ä¸Šå‡ ä¸ªæ–¹æ³•ä¹‹å‰,é¦–å…ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•</li>
<li>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­æ ¡éªŒå‚æ•°åˆæ³•æ€§ç­‰,ä»¥ä¿éšœä¹‹åè°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•ä¸ä¼šäº§ç”Ÿ<font color="red">crash</font></li>
<li>æ‰§è¡Œå®Œå‚æ•°åˆæ³•æ€§åˆ¤æ–­ä¹‹å,è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•,ä»¥è¾¾åˆ°é¢„æœŸè°ƒç”¨ç›®çš„</li>
</ol>
<h5 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹ "></a><font color="red">è¦ç‚¹ </font></h5><ol>
<li>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­NSMutableArrayå¯¹è±¡çš„Class åº”è¯¥æ˜¯<font color="red"><strong>__NSArrayM</strong> </font><small>(æ³¨æ„æ˜¯åŒä¸‹åˆ’çº¿)</small></li>
<li>å¿…é¡»ä¿è¯åœ¨NSMutableArrayè¿™ä¸ªå¯¹è±¡åˆå§‹åŒ–,æˆ–è€…ä½¿ç”¨ä¹‹å‰å·²ç»å®Œæˆ<font color="red"> <strong>Method Swizzing</strong> </font>æ›¿æ¢</li>
<li>arr[0] = @â€valueâ€ å’Œ [array addObject:@â€valueâ€] æˆ–è€… [array insertObject:@â€valueâ€ atIndex:0]<font color="red"><strong>è°ƒç”¨çš„ç³»ç»Ÿæ–¹æ³•æ˜¯ä¸åŒçš„</strong></font>.</li>
</ol>
<h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><h6 id="ä¸€ã€ä½¿ç”¨Method-Swizzingæ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•"><a href="#ä¸€ã€ä½¿ç”¨Method-Swizzingæ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•" class="headerlink" title="ä¸€ã€ä½¿ç”¨Method Swizzingæ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•"></a><small>ä¸€ã€ä½¿ç”¨<font color="red">Method Swizzing</font>æ›¿æ¢ä¸Šè¿°å‡ ä¸ªæ–¹æ³•</small></h6><p>è‡ªå®šä¹‰ä¸Šè¿°çš„å‡ ä¸ªæ–¹æ³•,ç”¨æ¥æ›¿æ¢ç³»ç»Ÿçš„å‡ ä¸ªæ–¹æ³•<small>(è¦æ±‚:å‚æ•°ç±»å‹,è¿”å›å€¼æœ€å¥½ä¿æŒä¸€è‡´)<font color="red">çœ‹å®Œè¿™å‡ ä¸ªæ–¹æ³•,å¯èƒ½æœ‰äº›è®¸ç–‘æƒ‘,ç¨åä¸ºä½ è§£ç­”</font></small>.</p>
<pre><code>//ç”¨æ¥æ›¿æ¢removeObject:æ–¹æ³•
-(void)customRemoveObject:(id)anObject{
    if (anObject) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
        //è°ƒç”¨ç³»ç»Ÿçš„RemoveObject:æ–¹æ³•
        [self customRemoveObject:anObject];
    }else{
        NSLog(@&quot;æ•°ç»„ç§»é™¤äº†ä¸€ä¸ªnilçš„å…ƒç´ &quot;);
    }
}
//æ›¿æ¢removeObjectAtIndex:æ–¹æ³•
-(void)customRemoveObjectAtIndex:(NSUInteger)index{
    if (index &lt; self.count) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
        //è°ƒç”¨ç³»ç»Ÿçš„RemoveObjectAtIndex:æ–¹æ³•
        [self customRemoveObjectAtIndex:index];
    }else{
        NSLog(@&quot;æ•°ç»„è¶Šç•Œæ“ä½œ,ä¸‹æ ‡ä¸º%lu&quot;,index);
    }
}
//ç”¨æ¥æ›¿æ¢åŒç±»çš„ arr[0] = @&quot;value&quot;è¿™ç§å†™æ³•
-(void)msySetObject:(id)obj atIndexedSubscript:(NSUInteger)idx{
    if (obj) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
        //è°ƒç”¨ç³»ç»Ÿçš„setObject:atIndexedSubscript:æ–¹æ³•
        [self msySetObject:obj atIndexedSubscript:idx];
    }else{
        NSLog(@&quot;æ•°ç»„èµ‹å€¼ä¸ºnilï¼š%sä¼ äº†ä¸ªç©ºå€¼\n&quot;,__func__);
    }
}
- (void)msyInsertObject:(id)anObject atIndex:(NSUInteger)index{
    if (anObject &amp;&amp; index &lt;= self.count) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
        //è°ƒç”¨ç³»ç»Ÿçš„insertObject:atIndex:æ–¹æ³•
        [self msyInsertObject:anObject atIndex:index];
    }else{
        NSLog(@&quot;æ•°ç»„èµ‹å€¼ä¸ºnilï¼š%sä¼ äº†ä¸ªç©ºå€¼\n&quot;,__func__);
    }
}
- (void)msyAddObject:(id)obj{
    if (obj) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
    //è°ƒç”¨ç³»ç»Ÿçš„ObjectAtIndex:æ–¹æ³•
        [self msyAddObject:obj];
    }else{
        NSLog(@&quot;æ•°ç»„èµ‹å€¼ä¸ºnilï¼š%sä¼ äº†ä¸ªç©ºå€¼\n&quot;,__func__);
    }
}
- (id)custmeObjectAtIndex:(NSInteger)index{
    if (index &gt;= self.count) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
        return nil;
    }
    //è°ƒç”¨ç³»ç»Ÿçš„ObjectAtIndex:æ–¹æ³•
    return [self custmeObjectAtIndex:index];
}
</code></pre><p><strong>è‡³æ­¤ ç”¨æ¥æ›¿æ¢ç³»ç»Ÿæ–¹æ³•çš„æ–¹æ³•å·²ç»å‡†å¤‡å¥½äº†</strong><br><br><strong>ç„¶åæˆ‘ä»¬è¦ç”¨è‡ªå·±çš„æ–¹æ³•å»æ›¿æ¢ç³»ç»Ÿçš„æ–¹æ³•çš„å®ç°</strong></p>
<pre><code>//å¿…é¡»åŒ…å«è¿è¡Œæ—¶çš„åº“
#import &lt;objc/runtime.h&gt;

//åœ¨loadæ–¹æ³•é‡Œè¾¹äº¤æ¢è‡ªå®šä¹‰æ–¹æ³•ä¸ç³»ç»Ÿæ–¹æ³•çš„å®ç°,
//å› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç±»åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¿è¯ç³»ç»Ÿæ–¹æ³•çš„å®ç°å·²ç»è¢«æˆ‘ä»¬æ›¿æ¢
+(void)load{

//å…ˆè·å–NSMutableArrayçš„Class @&quot;__NSArrayM&quot; ä¸ºåŒä¸‹åˆ’çº¿
Class arrayM = NSClassFromString(@&quot;__NSArrayM&quot;);

//è·å–å®ä¾‹æ–¹æ³•addObject:çš„Method
Method methodSuper = class_getInstanceMethod(arrayM, @selector(addObject:));
//è·å–è‡ªå·±å®šä¹‰çš„å®ä¾‹æ–¹æ³•msyAddObject:çš„Method
Method method = class_getInstanceMethod(arrayM, @selector(msyAddObject:));
//äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°
method_exchangeImplementations(methodSuper, method);

//ä¸€ä¸‹æ³¨é‡ŠåŒä¸Š
Method methodSuperInsert = class_getInstanceMethod(arrayM, @selector(insertObject:atIndex:));
Method methodInsert = class_getInstanceMethod(arrayM, @selector(msyInsertObject:atIndex:));
method_exchangeImplementations(methodSuperInsert, methodInsert);

Method methodSuperSetObj = class_getInstanceMethod(arrayM, @selector(setObject:atIndexedSubscript:));
Method methodSetObj = class_getInstanceMethod(arrayM, @selector(msySetObject:atIndexedSubscript:));
method_exchangeImplementations(methodSetObj, methodSuperSetObj);

Method methodSuperRemove = class_getInstanceMethod(arrayM, @selector(removeObjectAtIndex:));
Method methodRemove = class_getInstanceMethod(arrayM, @selector(customRemoveObjectAtIndex:));
method_exchangeImplementations(methodSuperRemove, methodRemove);

Method methodSuperRemoveObj = class_getInstanceMethod(arrayM, @selector(removeObject:));
Method methodRemoveObj = class_getInstanceMethod(arrayM, @selector(customRemoveObject:));
method_exchangeImplementations(methodSuperRemoveObj, methodRemoveObj);

Method objectAtIndex = class_getInstanceMethod(arrayM, @selector(objectAtIndex:));
Method customeObjectAtIndex = class_getInstanceMethod(arrayM, @selector(custmeObjectAtIndex:));
method_exchangeImplementations(objectAtIndex, customeObjectAtIndex);
</code></pre><p>}</p>
<h6 id="äºŒã€åˆ›å»ºä¸€ä¸ªNSMutableArray-çš„åˆ†ç±»-å°†ä¸Šè¿°ä»£ç æ”¾å…¥"><a href="#äºŒã€åˆ›å»ºä¸€ä¸ªNSMutableArray-çš„åˆ†ç±»-å°†ä¸Šè¿°ä»£ç æ”¾å…¥" class="headerlink" title="äºŒã€åˆ›å»ºä¸€ä¸ªNSMutableArray çš„åˆ†ç±»,å°†ä¸Šè¿°ä»£ç æ”¾å…¥"></a><small>äºŒã€åˆ›å»ºä¸€ä¸ªNSMutableArray çš„åˆ†ç±»,å°†ä¸Šè¿°ä»£ç æ”¾å…¥</small></h6><p><img src="/img/NSMutableArraySafeImage.png"><br>ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†<br><br>ç„¶åä½ å°±å¯ä»¥æ„‰å¿«çš„è¿™æ ·äº†</p>
<pre><code>NSMutableArray * array = [[NSMutableArray alloc]init];
[array addObject:nil];
[array addObjectsFromArray:nil];
[array insertObject:nil atIndex:0];
[array insertObject:@&quot;value&quot; atIndex:9999];
[array insertObjects:nil atIndexes:0];
[array removeObject:nil];
[array removeObjectAtIndex:9999];
[array removeObjectsInArray:nil];
</code></pre><p>å¹¶ä¸”ä½ ä¼šç¥å¥‡çš„å‘ç°ä»–æ²¡æœ‰crash</p>
<h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><ol>
<li><strong>ä¸Šè¿°ä»£ç ä¸­å‡ºç°äº†è‡ªå·±è°ƒç”¨è‡ªå·±</strong></li>
</ol>
<pre><code>-(void)msyAddObject:(id)obj{
        if (obj) {/*å‚æ•°åˆæ³•æ€§åˆ¤æ–­*/
          [self msyAddObject:obj];//è°ƒç”¨ç³»ç»Ÿçš„addObject:æ–¹æ³•
      }else{
           NSLog(@&quot;æ•°ç»„èµ‹å€¼ä¸ºnilï¼š%sä¼ äº†ä¸ªç©ºå€¼\n&quot;,__func__);
      }
 }
</code></pre><p><small>å¦‚æœä½ ç»†å¿ƒè‚¯å®šä¼šå‘ç°ç¬¬3è¡Œä»£ç å‡ºç°äº†è‡ªå·±è°ƒç”¨è‡ªå·±çš„æƒ…å†µ,ä½†æ˜¯æˆ‘åœ¨åè¾¹çš„æ³¨é‡Šç¡®æ˜¯<font color="green">//è°ƒç”¨ç³»ç»Ÿçš„addObject:æ–¹æ³•</font>.<br>æ­£å¸¸çš„è¯´,è¿™ç§æƒ…å†µåº”è¯¥æ˜¯ä¸€ä¸ªæ­»å¾ªç¯,ä½†æ˜¯ä½ ä¸è¦å¿˜äº†ç°åœ¨æˆ‘ä»¬ä½¿ç”¨äº†Method Swizzing,æˆ‘ä»¬å·²ç»ç”¨runtime å°†<font color="red">msyAddObject:æ–¹æ³•çš„æ–¹æ³•çš„<big><strong>å®ç°</strong></big>ä¸addObject:çš„<strong><big>å®ç°</big></strong>äº¤æ¢</font><br>æˆ‘ä»¬äº¤æ¢çš„åªæ˜¯å®ç°,åªæ˜¯æ–¹æ³•åè¿˜æ˜¯æ²¡æœ‰å˜,æ‰€ä»¥å†™åœ¨msyAddObject:çš„ä»£ç ,ç»è¿‡æˆ‘ä»¬çš„<font color="red">method_exchangeImplementations(Method m1,Method m2)</font>ä¹‹åå·²ç»ä¸æ˜¯å†™åœ¨msyAddObject:é‡Œè¾¹,è€Œæ˜¯åœ¨ç³»ç»Ÿçš„addObject:ä¸­,æ‰€ä»¥æˆ‘ä»¬åœ¨msyAddObject:è°ƒç”¨msyAddObject:çš„æ—¶å€™,å…¶å®æ˜¯è°ƒç”¨ç³»ç»ŸaddObject:çš„å®ç°,æ‰€ä»¥å¹¶ä¸æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±ğŸ˜„,ä¹Ÿå°±ä¸ä¼šå‡ºç°æ­»å¾ªç¯äº†</small></p>
<ol>
<li><strong>æˆ–è®¸ä½ å‘ç°æœ¬äººåœ¨åˆ›å»ºåˆ†ç±»çš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ª#ifdef DEBUG #else #endif</strong></li>
</ol>
<p><small>è¿™æ˜¯æ¡ä»¶ç¼–è¯‘,è¡¨ç¤ºåœ¨debugæ¨¡å¼ä¸‹ ä¼šç¼–è¯‘#ifdef å’Œ #elseä¹‹é—´çš„ä»£ç ,åœ¨releaseæ¨¡å¼ä¼šç¼–è¯‘#else #endifä¹‹é—´çš„ä»£ç ,è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™èƒ½å¤Ÿå°½å¤šçš„å‘ç°é—®é¢˜,è€Œåœ¨ä¸Šçº¿çš„æ—¶å€™å°½å¤šçš„é¿å…é—®é¢˜</small></p>
<h2 id="è¡¨è¾¾èƒ½åŠ›å¾ˆå·®-å¯èƒ½æœ‰äº›ä¸œè¥¿æ²¡è¯´æ¸…æ¥š-å¦‚æœ‰éœ€è¦å¯ä»¥æ·±å…¥æ²Ÿé€š"><a href="#è¡¨è¾¾èƒ½åŠ›å¾ˆå·®-å¯èƒ½æœ‰äº›ä¸œè¥¿æ²¡è¯´æ¸…æ¥š-å¦‚æœ‰éœ€è¦å¯ä»¥æ·±å…¥æ²Ÿé€š" class="headerlink" title="è¡¨è¾¾èƒ½åŠ›å¾ˆå·®,å¯èƒ½æœ‰äº›ä¸œè¥¿æ²¡è¯´æ¸…æ¥š,å¦‚æœ‰éœ€è¦å¯ä»¥æ·±å…¥æ²Ÿé€š."></a>è¡¨è¾¾èƒ½åŠ›å¾ˆå·®,å¯èƒ½æœ‰äº›ä¸œè¥¿æ²¡è¯´æ¸…æ¥š,å¦‚æœ‰éœ€è¦å¯ä»¥æ·±å…¥æ²Ÿé€š.</h2><p><strong><a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demoåœ°å€ : https://github.com/OneHalfTooth/Runtime_Safe</a></strong><br><br><strong>ä¸ªäººé‚®ç®±:mayang_email@sina.cn</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[runtimeä¹‹NSArrayå®‰å…¨]]></title>
      <url>http://yoursite.com/2016/01/22/runtime%E4%B9%8BNSArray%E3%80%81NSDictionary%E5%AE%89%E5%85%A8/</url>
      <content type="html"><![CDATA[<p>çœ‹äº†<a href="http://www.cnblogs.com/muyushifang07/p/5737564.html" target="_blank" rel="external"><strong>æ²é›¨åæ–¹07</strong></a>çš„è¿™ç¯‡åšå®¢ä¹‹åï¼Œæˆ‘å†³å®šå°†è‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„ä¸€ä¸ªå°æŠ€å·§åˆ†äº«ä¸€ä¸‹,ä»¥æ–¹ä¾¿å„ç§çŒ¿çš„ç¨‹åºå¼€å‘ã€‚</p>
   <a id="more"></a>  
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨appleçš„æ·«å¨ä¸‹NSArray,NSDictionary,NSMutableArray,NSMutableDictionaryæ˜¯ä¸ä¸èƒ½å‡ºç°æœ‰å…³nilçš„æ“ä½œ,ä¸€æ—¦æ“ä½œå°±ä¼šå‡ºç°<strong>crash</strong>çš„åæœ,å¦‚æœæˆ‘ä»¬è¦é¿å…è¿™ç§<strong>crash</strong>é‚£ä¹ˆå°±è¦å¢åŠ è®¸å¤šif,ç°åœ¨æˆ‘ä»¬æ¥åˆ©ç”¨runtimeå½»åº•è§£å†³è¿™ä¸ªé—®é¢˜.<br><br><br><a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">demoåœ°å€ : https://github.com/OneHalfTooth/Runtime_Safe</a></p>
<p><strong>é¦–å…ˆæˆ‘ä»¬å¯èƒ½ç”¨åˆ°å‡ ä¸ªå‡½æ•°</strong>ï¼ˆéœ€è¦åŒ…å«<font color="red">è¿è¡Œæ—¶åº“</font>ï¼‰<br><br> <font color="red">class_getInstanceMethod(Class cls, SEL name):å¾—åˆ°ç±»çš„å®ä¾‹æ–¹æ³•</font></p>
  <font color="red">class_getClassMethod(Class cls, SEL name):å¾—åˆ°ç±»çš„ç±»æ–¹æ³•</font>

<p>  <font color="red"> method_exchangeImplementations(Method m1, Method m2) : äº¤æ¢æ–¹æ³•m1 å’Œæ–¹æ³•m2çš„å®ç°</font></p>
<h2 id="runtimeä¹‹NSArrayçš„nilæ“ä½œ"><a href="#runtimeä¹‹NSArrayçš„nilæ“ä½œ" class="headerlink" title="runtimeä¹‹NSArrayçš„nilæ“ä½œ"></a>runtimeä¹‹NSArrayçš„nilæ“ä½œ</h2><p>ç ä»£ç çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸€ä¸å°å¿ƒå¯èƒ½å°±ä¼šå‡ºç°ç±»ä¼¼äºè¿™ç§æƒ…å†µ</p>
<pre><code>NSArray * temp = @[@&quot;0&quot;,@&quot;1&quot;,@&quot;2&quot;];
NSString * str = [temp objectAtIndex:4];
</code></pre><p>åæœå°±æ˜¯<strong>crash</strong><br><br>ä½†æ˜¯æˆ‘ä»¬å‘ç°å¤§ç‰›ä»¬å†™ä»£ç çš„æ—¶å€™é€šå¸¸<strong>å¾ˆå°‘å‡ºç°å¯¹æ•°ç»„è¶Šç•Œ</strong>çš„å¼‚å¸¸å¤„ç†æƒ…å†µ,åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ğŸ˜<br><br>è€Œæˆ‘æ˜¯ä½¿ç”¨runtimeçš„é»‘é­”æ³•æ¥è§£å†³è¿™ç§æƒ…å†µçš„,è¯·çœ‹æºç <br></p>
<pre><code>- (id)custmeObjectAtIndex:(NSInteger)index{
if (index &gt;= self.count) {
    return nil;
}
//æˆ–è®¸ä½ å¯¹è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œç¨åè§£ç­”
return [self custmeObjectAtIndex:index];
}
</code></pre><p>é¦–å…ˆæˆ‘å£°æ˜ä¸€ä¸ªæ–¹æ³•,å› ä¸ºæˆ‘è¦ç”¨é»‘é­”æ³•<font color="red">ï¼ˆMethod Swizzlingï¼‰</font>å°†ç³»ç»Ÿçš„<strong>objectAtIndex:</strong>æ–¹æ³•å®ç°ç»™æ›¿æ¢æ‰,è¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨<strong>NSArrayè°ƒç”¨objectAtIndex:</strong>æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆè°ƒç”¨<strong>(custmeObjectAtIndex:)</strong>æœ¬äººå®šä¹‰å¥½çš„æ–¹æ³•,ç„¶ååœ¨custmeObjectAtIndex:è¿™ä¸ªæ–¹æ³•ä¸­å»åˆ¤æ–­å‚æ•°åˆæ³•æ€§ï¼Œå†åšä¸‹ä¸€æ­¥æ‰“ç®—.<br><br>ç„¶åæˆ‘ä»¬å¼€å§‹ä½¿ç”¨<font color="red">ï¼ˆMethod Swizzlingï¼‰</font>å°†ç³»ç»Ÿ<strong>objectAtIndex:</strong>çš„å®ç°å’Œ<strong>(custmeObjectAtIndex:)</strong>çš„å®ç°è¿›è¡Œäº¤æ¢</p>
<pre><code>//NSArray åœ¨ç¼–è¯‘çš„æ—¶å€™åå­—å¹¶ä¸æ˜¯NSarrayè€Œæ˜¯__NSArray0
Class arrayM = NSClassFromString(@&quot;__NSArray0&quot;);

//è·å–åˆ°ç³»ç»ŸobjectAtIndex:
Method objectAtIndex = class_getInstanceMethod(arrayM, @selector(objectAtIndex:));

//è·å–è‡ªå®šä¹‰çš„custmeObjectAtIndex:
Method customeObjectAtIndex = class_getInstanceMethod(arrayM, @selector(custmeObjectAtIndex:));

//äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°
method_exchangeImplementations(objectAtIndex, customeObjectAtIndex);
</code></pre><p>è‡³æ­¤,æˆ‘ä»¬å¸¸è§çš„æ•°ç»„è¶Šç•Œcrashå·²ç»è¢«è§£å†³äº†,ä½†æ˜¯ä½ æ˜¯ä¸æ˜¯å·²ç»è’™åœˆäº†ğŸ˜,ä¸ºä»€ä¹ˆåœ¨<strong>- (id)custmeObjectAtIndex:(NSInteger)index</strong>æ–¹æ³•ä¸­å‡ºç°äº† <strong>[self custmeObjectAtIndex:index];</strong>è‡ªå·±è°ƒç”¨è‡ªå·±è¿™ç§æƒ…å†µå‘¢,å‰è¾¹æˆ‘å·²ç»è¯´äº†æ˜¯äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°,æ‰€ä»¥è¯´ä¸¤ä¸ªæ–¹æ³•çš„å†…å®¹<strong>(ç®€å•çš„è¯´å°±æ˜¯æ–¹æ³•é‡Œè¾¹çš„ä»£ç )</strong>å·²ç»è¢«äº¤æ¢,æ‰€ä»¥[self custmeObjectAtIndex:index]è¿™å¥ä»£ç è°ƒç”¨çš„ç³»ç»ŸobjectAtIndex:çš„å®ç°ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±</p>
<p><strong>æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹,æˆ‘ä»¬å¿…é¡»ä¿è¯ä»»ä½•æ—¶é—´,åªè¦æ˜¯æœ‰å…³NSArrayçš„æ“ä½œ,æˆ‘ä»¬çš„runtimeå·²ç»æ‰§è¡Œè¿‡äº†<br>æ‰€ä»¥æˆ‘ä»¬è¦åœ¨+ (void)loadæ–¹æ³•å»æ‰§è¡Œè¿™ä¸ªSwizzing</strong></p>
<pre><code>#import &lt;UIKit/UIKit.h&gt;
#import &lt;objc/runtime.h&gt;

//åˆ†ç±»
@implementation NSArray (Safe)
//åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¢«æ‰§è¡Œä¸€æ¬¡
+ (void)load {

Method originalMethod = class_getClassMethod(self, @selector(arrayWithObjects:count:));
Method swizzledMethod = class_getClassMethod(self, @selector(customArrayWithObjects:count:));
method_exchangeImplementations(originalMethod, swizzledMethod);

Class arrayM = NSClassFromString(@&quot;__NSArray0&quot;);
Method objectAtIndex = class_getInstanceMethod(arrayM, @selector(objectAtIndex:));
Method customeObjectAtIndex = class_getInstanceMethod(arrayM, @selector(custmeObjectAtIndex:));
method_exchangeImplementations(objectAtIndex, customeObjectAtIndex);

}


+ (instancetype)customArrayWithObjects:(const id [])objects count:(NSUInteger)cnt {

    id nObjects[cnt];
    int i=0, j=0;
    for (; i&lt;cnt &amp;&amp; j&lt;cnt; i++) {
        if (objects[i]) {
            nObjects[j] = objects[i];
            j++;
        }
    }
    return [self customArrayWithObjects:nObjects count:j];
}

- (id)custmeObjectAtIndex:(NSInteger)index{

    if (index &gt;= self.count) {
        return nil;
    }
return [self custmeObjectAtIndex:index];
}
</code></pre><p><strong>è‡³æ­¤ä¸€ä¸ªå…³äºNSArrayçš„å®‰å…¨ç±»å·²ç»ç»“æŸ,å½“ç„¶è¿™åªæ˜¯ä¸€éƒ¨åˆ†,æ›´è¯¦ç»†è¯·<a href="https://github.com/OneHalfTooth/Runtime_Safe" target="_blank" rel="external">æŸ¥çœ‹demo:https://github.com/OneHalfTooth/Runtime_Safe</a></strong><br><br><strong>æ¬¢è¿æå‡ºæ‚¨çš„å®è´µæ„è§:<font color="blue">mayang_email@sina.cn</font></strong></p>
]]></content>
    </entry>
    
  
  
</search>
